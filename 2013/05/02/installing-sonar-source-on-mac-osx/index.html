
<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Installing sonar source on Mac OSX | chapter31</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta content="" name="keywords">
    <meta content="Installing sonar source on Mac OSX - chapter31" property="og:title">
    <link rel="stylesheet" href="http://chapter31.com/css/style.css">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
    
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/github.min.css">
    
</head>

<body>

<section class="section">
  <div class="container">
    <nav class="nav">
      <div class="nav-left">
        <a class="nav-item" href="http://chapter31.com"><h1 class="title is-2">chapter31</h1></a>
      </div>
      <div class="nav-right">
        <nav class="nav-item level is-mobile">
          
          <a class="level-item" href="http://michaelsharman.com">
            <span class="icon">
              <i class="fa fa-user-circle"></i>
            </span>
          </a>
          
          <a class="level-item" href="https://github.com/michaelsharman">
            <span class="icon">
              <i class="fa fa-github"></i>
            </span>
          </a>
          
          <a class="level-item" href="https://twitter.com/michaelsharman">
            <span class="icon">
              <i class="fa fa-twitter"></i>
            </span>
          </a>
          
          <a class="level-item" href="/index.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>
          </a>
          
        </nav>
      </div>
    </nav>
  </div>
</section>

<section class="section">
  <div class="container">
    <h2 class="subtitle is-6">May 2, 2013</h2>
    <h1 class="title">Installing sonar source on Mac OSX</h1>
    
    <div class="content">
      

<p><strong>Update 30 June 2015</strong></p>

<p>Part 2 <a href="/2015/06/30/installing-sonar-source-on-mac-osx-part-2/">is here</a> with further instructions</p>

<p><span>&ndash;</span></p>

<p><a href="http://www.sonarsource.org/">Sonar Source</a> is a an open source, browser based tool to manage code quality. You download and install it, setup some language specific plugins then let it loose on your codebase.</p>

<p>It basically reports on data generated by doing a static analysis of your code on things like:</p>

<ul>
<li>Duplicate code</li>
<li>Comment coverage</li>
<li>Coding rules</li>
<li>Unit tests</li>
<li>Code complexity etc</li>
</ul>

<p>Installing it on a Mac is relatively painless, but there are quite a few steps to follow. Luckily brew comes to the rescue, so simply install it along with sonar-runner:</p>

<pre><code>brew update
brew install sonar
brew install sonar-runner
</code></pre>

<p>The way it works is, Sonar itself is just a reporting tool. It needs data to report on. Sonar-runner is the tool that actually does the static analysis of your codebase and then stores that data in a local datastore. You have several options to use, I chose MySQL.</p>

<p>Make sure MySQL is running and create a new database to hold the data generated by sonar-runner. I called mine _sonar<em>source</em>:</p>

<pre><code>CREATE DATABASE sonar_source;
</code></pre>

<p>Create a new user (sonar/sonar) and set privileges:</p>

<pre><code>CREATE USER 'sonar'@'localhost' IDENTIFIED BY 'sonar';
GRANT ALL PRIVILEGES ON sonar_source.* TO 'sonar'@'localhost';
FLUSH PRIVILEGES;
</code></pre>

<p>Now you need to set the <em>sonar</em> configuration options, make sure you enter the correct database name (_sonar<em>source</em> in our case). You can comment out most options except credentials and mysql (so comment out the embedded database):</p>

<pre><code>vi /usr/local/Cellar/sonar/3.5.1/libexec/conf/sonar.properties
</code></pre>

<p>You also need to specify in the <em>sonar-runner</em> properties file which database to connect to:</p>

<pre><code>vi /usr/local/Cellar/sonar-runner/2.1/libexec/conf/sonar-runner.properties
</code></pre>

<p>For me I uncommented out the MySQL connection details, and changed the databaes name in the connection string to _sonar<em>source</em></p>

<p>You should now be able to launch sonar, it&rsquo;s a web based tool so everything is managed in a browser. Open a terminal and type:</p>

<pre><code>sonar start
</code></pre>

<p>That works because <em>sonar</em> is in your path (via brew). The command will launch sonar so navigate to <a href="http://localhost:9000">http://localhost:9000</a> in your browser of choice. Login (admin/admin) and have a look around. Sonar takes around 20 seconds to fully start, so be patient.</p>

<p>Now you want to install some <em>quality profile</em> plugins for any supported language that you need (javascript, php etc). Navigate to:</p>

<pre><code>Settings -&gt; Configuration -&gt; Update Center
</code></pre>

<p>Click on the <em>Available Plugins</em> tab and install what you need. I installed:</p>

<ul>
<li>JavaScript</li>
<li>PHP</li>
<li>Python</li>
<li>XML</li>
</ul>

<p>You&rsquo;ll need to restart sonar for the installation(s) to take effect.</p>

<pre><code>sonar restart
</code></pre>

<p>Almost there&hellip;</p>

<p>Now in the terminal, go to the root directory of a project you want sonar to inspect, and create a project specific properties file:</p>

<pre><code>cd myproject
vi sonar-project.properties
</code></pre>

<p>Here&rsquo;s a sample file:</p>

<pre><code># required metadata
sonar.projectKey=com.mydomain:myprojectname
sonar.projectName=My Project Name
sonar.projectVersion=1.0.x

# optional description
sonar.projectDescription=Describe your project here

# path to source directories (required)
sonar.sources=htdocs

# path to test source directories (optional)
#sonar.tests=testDir1,testDir2

# path to project binaries (optional), for example directory of Java bytecode
#sonar.binaries=binDir

# optional comma-separated list of paths to libraries. Only path to JAR file is supported.
#sonar.libraries=path/to/library/*.jar,path/to/specific/library/myLibrary.jar,parent/*/*.jar

# The value of the property must be the key of the language.
sonar.language=js

# Additional parameters
#sonar.my.property=value
</code></pre>

<p>Note the <em>sonar.language</em> option for JavaScript is <em>js</em>. That&rsquo;s kinda hard to find, so if you want to have code coverage for JavaScript make sure you get that right or the runner will just throw errors.</p>

<p>Finally in the root directory of your project you can now execute the sonar-runner by typing:</p>

<pre><code>sonar-runner
</code></pre>

<p>This is the step that&rsquo;s actually examining your code, it only took about 10 seconds for me. Once that&rsquo;s finished go back to the sonar webpage (localhost:9000) and you should magically have a project setup to review.</p>

<p>There&rsquo;s a tonne of information there. You&rsquo;ll find generic things like number of lines of code, percentage of comments in the codebase etc. But you&rsquo;ll also potentially get a lot of violations. Think of linting etc, style of coding conventions and the like. The JavaScript quality control plugin in particular is pretty opinionated so your mileage may vary as to the usefulness of sonar.</p>

<p>It&rsquo;s a fantastic tool, so keep exploring :)</p>

<h2 id="update-6th-may-2013">Update 6th May 2013</h2>

<h3 id="excluding-files">Excluding files</h3>

<p>If you want to exclude certain files that are included in your <em>sonar.sources</em> property you can use wildcard matches. Note that although you <em>can</em> do this in the web console, that would be persisted in the local datastore but not in any project version control. I recommend putting this exclusion property in your sonar-project.properties file.</p>

<p>So, if you wanted to include everything in the <em>scripts</em> directory except the <em>vendor</em> folder:</p>

<pre><code class="language-bash">sonar.sources=www/scripts
sonar.exclusions=www/scripts/vendor/**/*.js
</code></pre>

<h3 id="out-of-memory-errors">Out of memory errors</h3>

<p>If <em>sonar-runner</em> is parsing a large codebase you might get an error like the following:</p>

<blockquote>
<p>Caused by: java.util.concurrent.ExecutionException: java.lang.OutOfMemoryError: Java heap space</p>
</blockquote>

<p>Note: you can get more verbose output from the runner by adding the <em>e</em> flag:</p>

<pre><code class="language-bash">sonar-runner -e
</code></pre>

<p>You can increase the Java heap size by running the following:</p>

<pre><code class="language-bash">export SONAR_RUNNER_OPTS=&quot;-Xmx512m -XX:MaxPermSize=512m&quot;
</code></pre>

    </div>
  </div>
</section>


<section class="section">
  <div class="container has-text-centered">
    <p>&copy; <a href="http://michaelsharman.com">Michael Sharman</a> 2017</p>
  </div>
</section>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js" integrity="sha256-KbfTjB0WZ8vvXngdpJGY3Yp3xKk+tttbqClO11anCIU=" crossorigin="anonymous"></script>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/languages/go.min.js"></script>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/languages/dockerfile.min.js"></script>

<script>hljs.initHighlightingOnLoad();</script>


<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-306772-2', 'auto');
ga('send', 'pageview');
</script>
<script async src='//www.google-analytics.com/analytics.js'></script>



</body>
</html>

